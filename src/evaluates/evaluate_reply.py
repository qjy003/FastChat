# 标准库导入from typing import Any# 应用程序核心模块from src.base.evaluate import EvaluateModule# 工具或实用函数from src.utils import trim_string, output_json_dataclass EvaluateReply(EvaluateModule):    """    对话回复结果质量评估模块    """    def initialize_prompt(self) -> str:        """        填写质量评估模块的提示词        Returns: 评估模块的提示词        """        return \            """# 角色 你是一个十分专业的客服回复质量检测人员，负责检测客服{salesperson_name}向User回复的内容的风险等级。目前{salesperson_name}正在尝试收集User的物流相关的信息。# 对话阶段规则0、若若User只是在回复物流信息则为正常阶段。1、若User明显在询问问题则当前为疑问阶段。2、若User表示没有物流需求或者当前不方便沟通的意向则当前为无意向阶段3、若User没有表达疑问或者没有表示无物流需求或者当前不方便沟通的意向时则为正常阶段4、若当前{salesperson_name}已经完成了物流信息时为结尾阶段# 对话规则 根据你判断的当前的对话阶段，在相应阶段的对话规则当中根据{salesperson_name}的最新回复执行下面的判断，并设置safe_level字段的值。## 疑问阶段对话规则1、判断{salesperson_name}的最新回复是否表达无法解答和相应的歉意，若是则将safe_level字段的值设置为1并结束判断，否则执行后续的判断；2、判断{salesperson_name}的最新回复和User提出的问题内容主题是否有很强相关性，若是则将safe_level字段的值设置为2并结束判断，否则执行后续的判断；3、判断{salesperson_name}的最新回复和User提出的问题内容主题是否有微弱的相关性，若是则将safe_level字段的值设置为0并结束判断，否则执行后续的判断；4、判断{salesperson_name}的最新回复和User提出的问题内容主题是否没有相关性，若无相关性则将safe_level字段的值设置为0并结束判断，否则将safe_level字段的值设置为1；## 无意向阶段对话规则1、判断{salesperson_name}的回复是否在向User表达歉意或者礼貌结束对话，若是则将safe_level字段的值设置为2，否则将safe_level字段的值设置为1。## 正常阶段对话规则1、判断{salesperson_name}的最新回复是否在向User询问物流相关的信息，若是则将safe_level字段的值设置为2，否则执行后续判断。2、判断{salesperson_name}的最新回复是否能够作为对User的最后一句回复的回复，若是则将safe_level字段的值设置为2，否则执行后续判断。3、判断{salesperson_name}的最新回复是否和User的最后一句回复有微弱的相关性，若是则将safe_level字段的值设置为1，否则将safe_level字段的值设置为0。## 结尾阶段1、可以礼貌地向User进行致谢并结束对话# {salesperson_name}的最新回复{generate_reply}# 输出格式{{"safe_level":"","reason":"","stage":"","stage_reason":""}}# 任务你需要严格按照输出格式来输出结果，你需要按照下面的执行步骤执行来补全safe_level、reason、stage和stage_reason字段的内容。执行步骤：首先，你需要依据对话历史当中User回复的最后一句话，根据对话阶段规则来判断出当前的对话阶段。然后，你需要执行对话规则当中的判断，并将分析的理由放置在字段reason当中，将当前的对话阶段放置在stage字段，将推理当前对话阶段的理由放置在stage_reason字段；# 对话历史{conversation_history}{generate_reply}# 输出格式{{"safe_level":"","reason":"","stage":"","stage_reason":""}}    """    def process_inference_results(self, inference_results: Any) -> Any:        """        处理质量评估模块推理生成的结果并按照约定好的格式返回结果        Args:            inference_results: 质量评估模块推理生成的结果        Returns: 处理后的返回结果        """        json_results_str = trim_string(inference_results)        json_results = output_json_data(json_results_str)        return json_results.get('safe_level', 2)